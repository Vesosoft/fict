<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>Veso's PGN Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="libs/chessboard.min.css" />
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: sans-serif;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    body.light {
      background: #f9f9f9;
      color: #222;
    }
    textarea {
      width: 100%;
      height: 150px;
      background: #1e1e1e;
      color: #f0f0f0;
      padding: 10px;
      border: 1px solid #444;
      font-family: monospace;
      transition: background 0.3s, color 0.3s;
    }
    body.light textarea {
      background: #fff;
      color: #000;
      border: 1px solid #ccc;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    button:hover {
      background: #555;
    }
    body.light button {
      background: #ddd;
      color: #222;
    }
    body.light button:hover {
      background: #bbb;
    }
    #board {
      width: 400px;
      margin-top: 20px;
    }
    #intro {
      margin-bottom: 15px;
      padding: 10px;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 8px;
      transition: background 0.3s, color 0.3s;
    }
    body.light #intro {
      background: #eee;
      border: 1px solid #ccc;
      color: #222;
    }
    #langSwitcher select {
      font-size: 16px;
      padding: 5px 10px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    #langSwitcher select:hover {
      background: #555;
    }
    body.light #langSwitcher select {
      background: #ddd;
      color: #222;
    }
    body.light #langSwitcher select:hover {
      background: #bbb;
    }
    #themeToggleBtn {
      font-size: 14px;
      padding: 7px 12px;
      margin-left: 10px;
      vertical-align: middle;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>Veso's PGN Viewer ü§†</h2>

<div id="langSwitcher">
  <select id="langSelect" aria-label="–ò–∑–±–æ—Ä –Ω–∞ –µ–∑–∏–∫">
    <option value="bg" selected>üáßüá¨ –ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
    <option value="ua">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
    <option value="cz">üá®üáø ƒåe≈°tina</option>
    <option value="pl">üáµüá± Polski</option>
    <option value="ro">üá∑üá¥ Rom√¢nƒÉ</option>
    <option value="en">üá¨üáß English</option>
  </select>
  <button id="themeToggleBtn" aria-label="–°–º—è–Ω–∞ –Ω–∞ —Ç—ä–º–Ω–∞/—Å–≤–µ—Ç–ª–∞ —Ç–µ–º–∞">üåô</button>
</div>

<div id="intro">
  –î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ PGN Viewer-–∞ –Ω–∞ –í–µ—Å–æ! –í—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä—Ç–∏—è –≤ PGN —Ñ–æ—Ä–º–∞—Ç –∏ —è –≥–ª–µ–¥–∞–π—Ç–µ —Ö–æ–¥ –ø–æ —Ö–æ–¥. –ù–∞—Å–ª–∞–¥–µ—Ç–µ —Å–µ! üç∫
</div>

<textarea id="pgn">1. e4 e5 2. Nf3 Nc6 3. Bb5 a6</textarea><br />

<div>
  <button id="loadBtn">–ó–∞—Ä–µ–¥–∏ –ø–∞—Ä—Ç–∏—è—Ç–∞</button>
  <button id="clearBtn">–ò–∑—á–∏—Å—Ç–∏</button>
  <button id="prevBtn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
  <button id="nextBtn">‚û°Ô∏è –ù–∞–ø—Ä–µ–¥</button>
  <button id="autoBtn">‚ñ∂Ô∏è Auto</button>
  <button id="saveBtn">üíæ –ó–∞–ø–∞–∑–∏</button>
</div>

<div id="board"></div>

<script src="libs/chess.min.js"></script>
<script src="libs/chessboard.min.js"></script>

<script>
const chess = new Chess();
let board = Chessboard('board', {
  position: 'start',
  draggable: false,
  showNotation: true,
  pieceTheme: 'libs/img/chesspieces/wikipedia/{piece}.png'
});

let moves = [];
let currentMove = 0;
let autoInterval = null;

const pgnTextarea = document.getElementById('pgn');
const intro = document.getElementById('intro');
const langSelect = document.getElementById('langSelect');
const themeToggleBtn = document.getElementById('themeToggleBtn');

const intros = {
  bg: "–î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ PGN Viewer-–∞ –Ω–∞ –í–µ—Å–æ! –í—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä—Ç–∏—è –≤ PGN —Ñ–æ—Ä–º–∞—Ç –∏ —è –≥–ª–µ–¥–∞–π—Ç–µ —Ö–æ–¥ –ø–æ —Ö–æ–¥. –ù–∞—Å–ª–∞–¥–µ—Ç–µ —Å–µ! üç∫",
  ua: "–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥–∞—á–∞ PGN –≤—ñ–¥ –í–µ—Å–æ! –í—Å—Ç–∞–≤—Ç–µ –ø–∞—Ä—Ç—ñ—é —É —Ñ–æ—Ä–º–∞—Ç—ñ PGN —ñ –ø–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ —Ö—ñ–¥ –∑–∞ —Ö–æ–¥–æ–º. –°–º–∞—á–Ω–æ–≥–æ! üç∫",
  cz: "V√≠tejte v PGN prohl√≠≈æeƒçi od Vesa! Vlo≈æte partii ve form√°tu PGN a sledujte ji tah po tahu. Na zdrav√≠! üç∫",
  pl: "Witamy w przeglƒÖdarce PGN Veso! Wklej partiƒô w formacie PGN i oglƒÖdaj ruch po ruchu. Na zdrowie! üç∫",
  ro: "Bine a»õi venit la vizualizatorul PGN al lui Veso! Introduce»õi o partidƒÉ PGN »ôi urmƒÉri»õi-o pas cu pas. Noroc! üç∫",
  en: "Welcome to Veso's PGN Viewer! Paste your PGN game and watch it move by move. Enjoy! üç∫"
};

const btnTexts = {
  bg: { load: "–ó–∞—Ä–µ–¥–∏ –ø–∞—Ä—Ç–∏—è—Ç–∞", clear: "–ò–∑—á–∏—Å—Ç–∏", prev: "‚¨ÖÔ∏è –ù–∞–∑–∞–¥", next: "‚û°Ô∏è –ù–∞–ø—Ä–µ–¥", auto: "‚ñ∂Ô∏è Auto", stop: "‚è∏Ô∏è –°–ø—Ä–∏", save: "üíæ –ó–∞–ø–∞–∑–∏" },
  ua: { load: "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–∞—Ä—Ç—ñ—é", clear: "–û—á–∏—Å—Ç–∏—Ç–∏", prev: "‚¨ÖÔ∏è –ù–∞–∑–∞–¥", next: "‚û°Ô∏è –í–ø–µ—Ä–µ–¥", auto: "‚ñ∂Ô∏è –ê–≤—Ç–æ", stop: "‚è∏Ô∏è –°—Ç–æ–ø", save: "üíæ –ó–±–µ—Ä–µ–≥—Ç–∏" },
  cz: { load: "Naƒç√≠st partii", clear: "Vyƒçistit", prev: "‚¨ÖÔ∏è Zpƒõt", next: "‚û°Ô∏è Dal≈°√≠", auto: "‚ñ∂Ô∏è Auto", stop: "‚è∏Ô∏è Stop", save: "üíæ Ulo≈æit" },
  pl: { load: "Wczytaj partiƒô", clear: "Wyczy≈õƒá", prev: "‚¨ÖÔ∏è Wstecz", next: "‚û°Ô∏è Dalej", auto: "‚ñ∂Ô∏è Auto", stop: "‚è∏Ô∏è Stop", save: "üíæ Zapisz" },
  ro: { load: "√éncarcƒÉ partida", clear: "CurƒÉ»õƒÉ", prev: "‚¨ÖÔ∏è √énapoi", next: "‚û°Ô∏è UrmƒÉtor", auto: "‚ñ∂Ô∏è Auto", stop: "‚è∏Ô∏è Opre»ôte", save: "üíæ SalveazƒÉ" },
  en: { load: "Load Game", clear: "Clear", prev: "‚¨ÖÔ∏è Prev", next: "‚û°Ô∏è Next", auto: "‚ñ∂Ô∏è Auto", stop: "‚è∏Ô∏è Stop", save: "üíæ Save" }
};

function setLang(lang) {
  intro.textContent = intros[lang] || intros['en'];
  const texts = btnTexts[lang] || btnTexts['en'];
  document.getElementById('loadBtn').textContent = texts.load;
  document.getElementById('clearBtn').textContent = texts.clear;
  document.getElementById('prevBtn').textContent = texts.prev;
  document.getElementById('nextBtn').textContent = texts.next;
  document.getElementById('saveBtn').textContent = texts.save;
  document.getElementById('autoBtn').textContent = autoInterval ? texts.stop : texts.auto;
}

document.getElementById('loadBtn').onclick = () => {
  const pgn = pgnTextarea.value.trim();
  if (!pgn) return alert(intros[langSelect.value] ? "–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ PGN." : "Please enter PGN.");
  if (!chess.load_pgn(pgn)) return alert(intros[langSelect.value] ? "–ù–µ–≤–∞–ª–∏–¥–µ–Ω PGN!" : "Invalid PGN!");
  moves = chess.history();
  currentMove = 0;
  updateBoard();
};

document.getElementById('clearBtn').onclick = () => {
  pgnTextarea.value = '';
  chess.reset();
  board.position('start');
  moves = [];
  currentMove = 0;
  if (autoInterval) {
    clearInterval(autoInterval);
    autoInterval = null;
    setLang(langSelect.value);
  }
};

document.getElementById('prevBtn').onclick = () => {
  if (currentMove > 0) currentMove--;
  updateBoard();
};

document.getElementById('nextBtn').onclick = () => {
  if (currentMove < moves.length) currentMove++;
  updateBoard();
};

document.getElementById('autoBtn').onclick = () => {
  const lang = langSelect.value;
  const texts = btnTexts[lang] || btnTexts['en'];
  if (autoInterval) {
    clearInterval(autoInterval);
    autoInterval = null;
    document.getElementById('autoBtn').textContent = texts.auto;
  } else {
    autoInterval = setInterval(() => {
      if (currentMove < moves.length) {
        currentMove++;
        updateBoard();
      } else {
        clearInterval(autoInterval);
        autoInterval = null;
        document.getElementById('autoBtn').textContent = texts.auto;
      }
    }, 1000);
    document.getElementById('autoBtn').textContent = texts.stop;
  }
};

document.getElementById('saveBtn').onclick = () => {
  const blob = new Blob([pgnTextarea.value], { type
