<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PGN Viewer ‚Äî Veso Ignatov</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/js/chessboard.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/css/chessboard.min.css">
  <style>
    body {
      background-color: #121212;
      color: #eee;
      font-family: sans-serif;
      padding: 2em;
      text-align: center;
    }
    #board {
      width: 400px;
      margin: 20px auto;
    }
    button {
      margin: 5px;
      padding: 0.5em 1em;
      font-size: 1em;
      background-color: #333;
      color: #eee;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    input[type="file"] {
      margin-top: 1em;
    }
    pre {
      background: #1e1e1e;
      padding: 1em;
      text-align: left;
      white-space: pre-wrap;
      border: 1px solid #444;
      max-width: 600px;
      margin: 2em auto;
    }
  </style>
</head>
<body>

<h1>‚ôüÔ∏è Veso's PGN Viewer</h1>
<div id="board"></div>

<div>
  <button onclick="prev()">‚èÆÔ∏è –ù–∞–∑–∞–¥</button>
  <button onclick="next()">‚è≠Ô∏è –ù–∞–ø—Ä–µ–¥</button>
  <button onclick="resetBoard()">üîÅ –û—Ç–Ω–∞—á–∞–ª–æ</button>
  <button onclick="playAuto()">‚ñ∂Ô∏è –ü—É—Å–Ω–∏</button>
</div>

<input type="file" id="pgnFile" accept=".pgn">
<br>
<button onclick="downloadPGN()">üì• –ò–∑—Ç–µ–≥–ª–∏ —Ç–µ–∫—É—â–∞—Ç–∞ –ø–∞—Ä—Ç–∏—è</button>

<pre id="pgnText"></pre>

<script>
  const board = Chessboard('board', 'start');
  const game = new Chess();

  let moves = [];
  let currentMove = 0;
  let autoplay;

  const examplePGN = `[Event "Online Game"]
[Site "Checkmate Chess"]
[Date "2025.6.30"]
[Round "1"]
[White "DamianGuzman"]
[Black "Veso-Ignatov73"]
[Result "0-1"]
[TimeControl "1800"]
[WhiteElo "2000"]
[BlackElo "2336"]
[Time "21:45:01"]

1. Nb1-c3 d7-d5
2. d2-d4 c7-c6
3. e2-e4 d5xe4
4. Nc3xe4 Bc8-f5
5. f2-f3 e7-e6
6. Bc1-g5 Bf8-e7
7. Bg5xe7 Qd8xe7
8. g2-g4 Bf5xe4
9. f3xe4 Qe7-h4+
10. Ke1-e2 Ng8-f6
11. Ng1-f3 Qh4xg4
12. h2-h3 Qg4xe4+
13. Ke2-f2 Nb8-d7
14. Qd1-d3 Qe4-f4+
15. b2-b3 Nd7-c5
16. d4xc5 Ra8-d8
17. Qd3-e3 Nf6-e4+
18. Kf2-e2 Ne4-g3+
19. Ke2-f2 Ng3xh1+
20. Kf2-e1 Qf4xe3+`;

  function loadPGN(pgn) {
    game.reset();
    game.load_pgn(pgn);
    moves = game.history();
    currentMove = 0;
    board.position(game.fen());
    document.getElementById("pgnText").textContent = pgn;
  }

  function next() {
    if (currentMove < moves.length) {
      game.move(moves[currentMove++]);
      board.position(game.fen());
    }
  }

  function prev() {
    if (currentMove > 0) {
      game.undo();
      currentMove--;
      board.position(game.fen());
    }
  }

  function resetBoard() {
    game.reset();
    currentMove = 0;
    board.start();
  }

  function playAuto() {
    clearInterval(autoplay);
    resetBoard();
    autoplay = setInterval(() => {
      if (currentMove < moves.length) {
        next();
      } else {
        clearInterval(autoplay);
      }
    }, 800);
  }

  function downloadPGN() {
    const blob = new Blob([game.pgn()], {type: "text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "veso_game.pgn";
    a.click();
    URL.revokeObjectURL(url);
  }

  document.getElementById("pgnFile").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function (e) {
      loadPGN(e.target.result);
    };
    reader.readAsText(file);
  });

  // Load default
  loadPGN(examplePGN);
</script>

</body>
</html>