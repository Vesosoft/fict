<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Veso's PGN Viewer ü§†üíô</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: #1e1e1e;
    color: #f0f0f0;
  }
  #header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }
  h2 {
    color: #00c6ff;
    margin: 0;
  }
  /* Language dropdown */
  .dropdown {
    position: relative;
    display: inline-block;
  }
  .dropbtn {
    background-color: #444;
    color: white;
    padding: 6px 10px;
    font-size: 14px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }
  .dropbtn:hover {
    background-color: #666;
  }
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #2a2a2a;
    min-width: 140px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);
    border-radius: 4px;
    z-index: 1;
    margin-top: 5px;
  }
  .dropdown-content div {
    color: #f0f0f0;
    padding: 8px 12px;
    cursor: pointer;
    user-select: none;
  }
  .dropdown-content div:hover {
    background-color: #444;
  }
  .dropdown:hover .dropdown-content {
    display: block;
  }

  #board {
    width: 400px;
    max-width: 100%;
    margin-bottom: 10px;
  }
  #pgn {
    width: 100%;
    height: 120px;
    margin-top: 10px;
    font-family: monospace;
    background-color: #2b2b2b;
    color: #ffffff;
    border: 1px solid #444;
    resize: vertical;
  }
  #controls button, #copyLinkBtn, #loadFileBtn {
    margin: 5px 5px 5px 0;
    padding: 7px 14px;
    cursor: pointer;
    background-color: #444;
    color: #fff;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    user-select: none;
  }
  #controls button:hover, #copyLinkBtn:hover, #loadFileBtn:hover {
    background-color: #666;
  }
  #shareBtn {
    display: inline-block;
    margin: 5px 5px 5px 0;
    padding: 7px 14px;
    background-color: #444;
    color: #fff;
    border-radius: 4px;
    text-decoration: none;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
  }
  #shareBtn:hover {
    background-color: #666;
  }
  .info {
    background: #2a2a2a;
    padding: 10px;
    border: 1px solid #444;
    margin-bottom: 10px;
    line-height: 1.4;
  }

  /* Responsive layout */
  @media (max-width: 600px) {
    #header {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    #board {
      width: 100%;
      max-width: 100%;
    }
    #pgn {
      height: 150px;
    }
    #controls button, #copyLinkBtn, #loadFileBtn, #shareBtn {
      flex: 1 1 45%;
      font-size: 16px;
      padding: 10px;
    }
    .dropdown {
      width: 100%;
    }
    .dropbtn {
      width: 100%;
      text-align: left;
    }
    .dropdown-content {
      min-width: 100%;
      box-sizing: border-box;
    }
  }
</style>
<link rel="stylesheet" href="https://unpkg.com/chessboardjs@1.0.0/www/css/chessboard-1.0.0.min.css" />
</head>
<body>

<div id="header">
  <h2>Veso's PGN Viewer ü§†üíô</h2>
  <div class="dropdown" aria-label="–ò–∑–±–æ—Ä –Ω–∞ –µ–∑–∏–∫">
    <button class="dropbtn" id="langBtn" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu">–ï–∑–∏–∫: üáßüá¨ –ë—ä–ª–≥–∞—Ä—Å–∫–∏ ‚ñº</button>
    <div class="dropdown-content" id="langMenu" role="menu">
      <div role="menuitem" data-lang="bg">üáßüá¨ –ë—ä–ª–≥–∞—Ä—Å–∫–∏</div>
      <div role="menuitem" data-lang="en">üá¨üáß English</div>
      <div role="menuitem" data-lang="ua">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</div>
    </div>
  </div>
</div>

<div class="info" id="infoBlock">
  üìù –ü–æ—Å—Ç–∞–≤–µ—Ç–µ —Ç—É–∫ —Å–≤–æ—è —à–∞—Ö–º–∞—Ç–µ–Ω –∑–∞–ø–∏—Å (PGN) ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ —Å–∏ –ø–∞—Ä—Ç–∏—è –æ—Ç –æ–Ω–ª–∞–π–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞.
</div>

<div id="board"></div>

<textarea id="pgn" placeholder="–ü–æ—Å—Ç–∞–≤–∏ —Ç—É–∫ —Å–≤–æ—è—Ç–∞ PGN –ø–∞—Ä—Ç–∏—è..." spellcheck="false"></textarea>

<div id="controls">
  <button id="startBtn">–ù–∞—á–∞–ª–æ</button>
  <button id="prevBtn">–ù–∞–∑–∞–¥</button>
  <button id="nextBtn">–ù–∞–ø—Ä–µ–¥</button>
  <button id="endBtn">–ö—Ä–∞–π</button>
  <button id="copyLinkBtn">–ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫–∞</button>
  <a id="shareBtn" href="#" target="_blank" rel="noopener">–°–ø–æ–¥–µ–ª–∏ –≤—ä–≤ Facebook</a>
  <button id="loadFileBtn">üìÇ –ó–∞—Ä–µ–¥–∏ PGN —Ñ–∞–π–ª</button>
  <input type="file" id="fileInput" accept=".pgn" style="display:none;" />
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
<script src="https://unpkg.com/chessboardjs@1.0.0/www/js/chessboard-1.0.0.min.js"></script>
<script>
  const board = Chessboard('board', {
    draggable: false,
    position: 'start',
  });

  const chess = new Chess();
  let moves = [];
  let currentMoveIndex = 0;

  const translations = {
    bg: {
      title: "Veso's PGN Viewer ü§†üíô",
      info: "üìù –ü–æ—Å—Ç–∞–≤–µ—Ç–µ —Ç—É–∫ —Å–≤–æ—è —à–∞—Ö–º–∞—Ç–µ–Ω –∑–∞–ø–∏—Å (PGN) ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ —Å–∏ –ø–∞—Ä—Ç–∏—è –æ—Ç –æ–Ω–ª–∞–π–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞.",
      startBtn: "–ù–∞—á–∞–ª–æ",
      prevBtn: "–ù–∞–∑–∞–¥",
      nextBtn: "–ù–∞–ø—Ä–µ–¥",
      endBtn: "–ö—Ä–∞–π",
      copyLinkBtn: "–ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫–∞",
      shareBtn: "–°–ø–æ–¥–µ–ª–∏ –≤—ä–≤ Facebook",
      loadFileBtn: "üìÇ –ó–∞—Ä–µ–¥–∏ PGN —Ñ–∞–π–ª",
      langBtn: "–ï–∑–∏–∫: üáßüá¨ –ë—ä–ª–≥–∞—Ä—Å–∫–∏ ‚ñº",
      pgnPlaceholder: "–ü–æ—Å—Ç–∞–≤–∏ —Ç—É–∫ —Å–≤–æ—è—Ç–∞ PGN –ø–∞—Ä—Ç–∏—è..."
    },
    en: {
      title: "Veso's PGN Viewer ü§†üíô",
      info: "üìù Paste your chess PGN here ‚Äî for example, your latest game from an online platform.",
      startBtn: "Start",
      prevBtn: "Previous",
      nextBtn: "Next",
      endBtn: "End",
      copyLinkBtn: "Copy Link",
      shareBtn: "Share on Facebook",
      loadFileBtn: "üìÇ Load PGN file",
      langBtn: "Language: üá¨üáß English ‚ñº",
      pgnPlaceholder: "Paste your PGN game here..."
    },
    ua: {
      title: "Veso's PGN Viewer ü§†üíô",
      info: "üìù –í—Å—Ç–∞–≤—Ç–µ —Ç—É—Ç —Å–≤—ñ–π —à–∞—Ö–æ–≤–∏–π –∑–∞–ø–∏—Å (PGN) ‚Äî –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ—Å—Ç–∞–Ω–Ω—é –ø–∞—Ä—Ç—ñ—é –∑ –æ–Ω–ª–∞–π–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏.",
      startBtn: "–ü–æ—á–∞—Ç–æ–∫",
      prevBtn: "–ù–∞–∑–∞–¥",
      nextBtn: "–í–ø–µ—Ä–µ–¥",
      endBtn: "–ö—ñ–Ω–µ—Ü—å",
      copyLinkBtn: "–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è",
      shareBtn: "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è —É Facebook",
      loadFileBtn: "üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PGN —Ñ–∞–π–ª",
      langBtn: "–ú–æ–≤–∞: üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ ‚ñº",
      pgnPlaceholder: "–í—Å—Ç–∞–≤—Ç–µ —Ç—É—Ç —Å–≤—ñ–π PGN..."
    }
  };

  let currentLang = 'bg';
  function updateTexts(lang) {
    currentLang = lang;
    document.querySelector('h2').textContent = translations[lang].title;
    document.getElementById('infoBlock').textContent = translations[lang].info;
    document.getElementById('startBtn').textContent = translations[lang].startBtn;
    document.getElementById('prevBtn').textContent = translations[lang].prevBtn;
    document.getElementById('nextBtn').textContent = translations[lang].nextBtn;
    document.getElementById('endBtn').textContent = translations[lang].endBtn;
    document.getElementById('copyLinkBtn').textContent = translations[lang].copyLinkBtn;
    document.getElementById('shareBtn').textContent = translations[lang].shareBtn;
    document.getElementById('loadFileBtn').textContent = translations[lang].loadFileBtn;
    document.getElementById('langBtn').textContent = translations[lang].langBtn;
    document.getElementById('pgn').placeholder = translations[lang].pgnPlaceholder;
    updateShareLink();
  }

  // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ PGN
  function loadPGN() {
    const pgnText = document.getElementById('pgn').value;
    const loaded = chess.load_pgn(pgnText);
    if (!loaded) {
      alert(currentLang === 'bg' ? '–ù–µ–≤–∞–ª–∏–¥–µ–Ω PGN –∑–∞–ø–∏—Å!' : currentLang === 'en' ? 'Invalid PGN!' : '–ù–µ–≤—ñ—Ä–Ω–∏–π PGN!');
      return false;
    }
    moves = chess.history();
    currentMoveIndex = 0;
    board.position(chess.fen());
    return true;
  }

  // –ü—Ä–µ–º–µ—Å—Ç–≤–∞–Ω–µ –¥–æ —Ö–æ–¥
  function moveTo(index) {
    chess.reset();
    for (let i = 0; i < index; i++) {
      chess.move(moves[i]);
    }
    board.position(chess.fen());
    currentMoveIndex = index;
  }

  // –†–µ—Å—Ç–∞—Ä—Ç –∏–≥—Ä–∞
  function resetGame() {
    if (!loadPGN()) return;
    board.position(chess.fen());
  }

  function nextMove() {
    if (currentMoveIndex < moves.length) {
      chess.move(moves[currentMoveIndex]);
      currentMoveIndex++;
      board.position(chess.fen());
    }
  }

  function prevMove() {
    if (currentMoveIndex > 0) {
      moveTo(currentMoveIndex - 1);
    }
  }

  document.getElementById('startBtn').addEventListener('click', resetGame);
  document.getElementById('endBtn').addEventListener('click', () => {
    if (!loadPGN()) return;
    moveTo(moves.length);
  });
  document.getElementById('nextBtn').addEventListener('click', nextMove);
  document.getElementById('prevBtn').addEventListener('click', prevMove);

  document.getElementById('copyLinkBtn').addEventListener('click', () => {
    navigator.clipboard.writeText(window.location.href).then(() => {
      alert(currentLang === 'bg' ? '–õ–∏–Ω–∫—ä—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω!' : currentLang === 'en' ? 'Link copied!' : '–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!');
    });
  });

  function updateShareLink() {
    const url = encodeURIComponent(window.location.href);
    const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    document.getElementById('shareBtn').setAttribute('href', fbUrl);
  }
  updateShareLink();

  // –¢—É–∫ –¥–æ–±–∞–≤—è–º–µ —Å–ª—É—à–∞—Ç–µ–ª, –∫–æ–π—Ç–æ —Å–ø–∏—Ä–∞ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ –∏ –æ—Ç–≤–∞—Ä—è Facebook share –≤ –Ω–æ–≤ –ø—Ä–æ–∑–æ—Ä–µ—Ü:
  document.getElementById('shareBtn').addEventListener('click', function(event) {
    event.preventDefault(); // –°–ø–∏—Ä–∞ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ
    const url = encodeURIComponent(window.location.href);
    const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    const width = 600;
    const height = 400;
    const left = (screen.width / 2) - (width / 2);
    const top = (screen.height / 2) - (height / 2);

    window.open(
      fbUrl,
      'fbShareWindow',
      `width=${width},height=${height},top=${top},left=${left},resizable=yes,scrollbars=yes,status=yes`
    );
  });

  document.getElementById('loadFileBtn').addEventListener('click', () => {
    document.getElementById('fileInput').click();
  });

  document.getElementById('fileInput').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      document.getElementById('pgn').value = e.target.result;
      resetGame();
    };
    reader.readAsText(file);
  });

  // –ú–µ–Ω—é –∑–∞ –µ–∑–∏–∫
  document.querySelectorAll('#langMenu div').forEach(item => {
    item.addEventListener('click', () => {
      updateTexts(item.getAttribute('data-lang'));
    });
  });

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Å–∏—á–∞–Ω–µ –Ω–∞ PGN –≤ –∫–ª–∏–ø–±–æ—Ä–¥–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
  window.addEventListener('load', async () => {
    try {
      const text = await navigator.clipboard.readText();
      if (text.includes("1.") && text.length > 20 && text.includes(" ")) {
        if (confirm(currentLang === 'bg' ? "–û—Ç–∫—Ä–∏—Ç –µ PGN —Ç–µ–∫—Å—Ç –≤ –∫–ª–∏–ø–±–æ—Ä–¥–∞. –ò—Å–∫–∞—à –ª–∏ –¥–∞ –≥–æ –∑–∞—Ä–µ–¥–∏–º?" : currentLang === 'en' ? "PGN text detected in clipboard. Load it?" : "–í–∏—è–≤–ª–µ–Ω–æ PGN —É –±—É—Ñ–µ—Ä—ñ –æ–±–º—ñ–Ω—É. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏?")) {
          document.getElementById('pgn').value = text;
          resetGame();
        }
      }
    } catch(e) {
      // clipboard not accessible ‚Äî –æ–∫
    }
  });
</script>

</body>
</html>