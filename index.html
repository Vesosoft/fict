<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>Veso's PGN Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="libs/chessboard-0.3.0.min.css" />
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: sans-serif;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    body.light {
      background: #f9f9f9;
      color: #222;
    }
    textarea {
      width: 100%;
      height: 150px;
      background: #1e1e1e;
      color: #f0f0f0;
      padding: 10px;
      border: 1px solid #444;
      font-family: monospace;
      transition: background 0.3s, color 0.3s;
    }
    body.light textarea {
      background: #fff;
      color: #000;
      border: 1px solid #ccc;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    button:hover {
      background: #555;
    }
    body.light button {
      background: #ddd;
      color: #222;
    }
    body.light button:hover {
      background: #bbb;
    }
    #board {
      width: 400px;
      margin-top: 20px;
    }
    #intro {
      margin-bottom: 15px;
      padding: 10px;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 8px;
      transition: background 0.3s, color 0.3s;
    }
    body.light #intro {
      background: #eee;
      border: 1px solid #ccc;
      color: #222;
    }
    #langSwitcher select {
      font-size: 16px;
      padding: 5px 10px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    #langSwitcher select:hover {
      background: #555;
    }
    body.light #langSwitcher select {
      background: #ddd;
      color: #222;
    }
    body.light #langSwitcher select:hover {
      background: #bbb;
    }
    #themeToggleBtn {
      font-size: 14px;
      padding: 7px 12px;
      margin-left: 10px;
      vertical-align: middle;
    }
  </style>
</head>
<body>

<h2>Veso's PGN Viewer 🤠</h2>

<div id="langSwitcher">
  <select id="langSelect" aria-label="Избор на език">
    <option value="bg" selected>🇧🇬 Български</option>
    <option value="ua">🇺🇦 Українська</option>
    <option value="cz">🇨🇿 Čeština</option>
    <option value="pl">🇵🇱 Polski</option>
    <option value="ro">🇷🇴 Română</option>
    <option value="en">🇬🇧 English</option>
  </select>
  <button id="themeToggleBtn" aria-label="Смяна на тъмна/светла тема">🌙</button>
</div>

<div id="intro">
  Добре дошли в PGN Viewer-а на Весо! Въведете партия в PGN формат и я гледайте ход по ход. Насладете се! 🍺
</div>

<textarea id="pgn">1. e4 e5 2. Nf3 Nc6 3. Bb5 a6</textarea><br />

<div>
  <button id="loadBtn">Зареди партията</button>
  <button id="clearBtn">Изчисти</button>
  <button id="prevBtn">⬅️ Назад</button>
  <button id="nextBtn">➡️ Напред</button>
  <button id="autoBtn">▶️ Auto</button>
  <button id="saveBtn">💾 Запази</button>
</div>

<div id="board"></div>

<!-- Скриптове -->
<script src="libs/chess.min.js"></script>
<script src="libs/chessboard-0.3.0.min.js"></script>

<script>
const chess = new Chess();
const board = new Chessboard('board', { position: 'start', draggable: false });

let moves = [];
let currentMove = 0;
let autoInterval = null;

const pgnTextarea = document.getElementById('pgn');
const intro = document.getElementById('intro');
const langSelect = document.getElementById('langSelect');
const themeToggleBtn = document.getElementById('themeToggleBtn');

document.getElementById('loadBtn').onclick = () => {
  if (chess.load_pgn(pgnTextarea.value)) {
    moves = chess.history();
    currentMove = 0;
    updateBoard();
  } else {
    alert("Невалиден PGN!");
  }
};

document.getElementById('clearBtn').onclick = () => {
  pgnTextarea.value = '';
  chess.reset();
  board.position('start');
};

document.getElementById('prevBtn').onclick = () => {
  if (currentMove > 0) currentMove--;
  updateBoard();
};

document.getElementById('nextBtn').onclick = () => {
  if (currentMove < moves.length) currentMove++;
  updateBoard();
};

document.getElementById('autoBtn').onclick = () => {
  if (autoInterval) {
    clearInterval(autoInterval);
    autoInterval = null;
    document.getElementById('autoBtn').textContent = '▶️ Auto';
  } else {
    autoInterval = setInterval(() => {
      if (currentMove < moves.length) {
        currentMove++;
        updateBoard();
      } else {
        clearInterval(autoInterval);
        document.getElementById('autoBtn').textContent = '▶️ Auto';
        autoInterval = null;
      }
    }, 1000);
    document.getElementById('autoBtn').textContent = '⏸️ Спри';
  }
};

document.getElementById('saveBtn').onclick = () => {
  const blob = new Blob([pgnTextarea.value], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'game.pgn';
  a.click();
};

function updateBoard() {
  chess.reset();
  for (let i = 0; i < currentMove; i++) {
    chess.move(moves[i]);
  }
  board.position(chess.fen());
}

// Езикови текстове
const intros = {
  bg: "Добре дошли в PGN Viewer-а на Весо! Въведете партия в PGN формат и я гледайте ход по ход. Насладете се! 🍺",
  ua: "Ласкаво просимо до переглядача PGN від Весо! Вставте партію у форматі PGN і переглядайте хід за ходом. Смачного! 🍺",
  cz: "Vítejte v PGN prohlížeči od Vesa! Vložte partii ve formátu PGN a sledujte ji tah po tahu. Na zdraví! 🍺",
  pl: "Witamy w przeglądarce PGN Veso! Wklej partię w formacie PGN i oglądaj ruch po ruchu. Na zdrowie! 🍺",
  ro: "Bine ați venit la vizualizatorul PGN al lui Veso! Introduceți o partidă PGN și urmăriți-o pas cu pas. Noroc! 🍺",
  en: "Welcome to Veso's PGN Viewer! Paste your PGN game and watch it move by move. Enjoy! 🍺"
};

function setLang(lang) {
  intro.textContent = intros[lang] || intros['en'];
}

// Свързваме смяната на езика с падащото меню
langSelect.addEventListener('change', () => {
  setLang(langSelect.value);
});

// Инициално задаване на езика според избора по подразбиране
setLang(langSelect.value);

// Задаване на тема от localStorage при зареждане
document.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'light') {
    document.body.classList.add('light');
    themeToggleBtn.textContent = '🌞';
  } else {
    document.body.classList.remove('light');
    themeToggleBtn.textContent = '🌙';
  }
});

// Функция за смяна на тема с запазване в localStorage
themeToggleBtn.addEventListener('click', () => {
  const isLight = document.body.classList.toggle('light');
  if (isLight) {
    themeToggleBtn.textContent = '🌞';
    localStorage.setItem('theme', 'light');
  } else {
    themeToggleBtn.textContent = '🌙';
    localStorage.setItem('theme', 'dark');
  }
});
</script>

</body>
</html>
